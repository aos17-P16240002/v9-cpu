# 操作系统实验二报告 
## 目标： 建立页表

本实验中建立了一个二级页表，而且实现了对不同中断类型分别处理。

系统启动后，先设置中断处理例程，并且打开中断使能。
然后对一些CPU的中断类型进行了测试。紧接着建立页表进行内存管理。

需要预先为页表分配存储空间，一个页目录或者页表需要4KB，每个页表可以管理4MB的内存空间。实验中设置了32个页表，可以使用的内存空间有32*4MB = 128MB。
由于页表需要进行地址对齐，在加上一个页目录和32个页表，总计需要为页表预分配34*4KB的内存空间。

具体的在建立页表的过程中，大概经过这几个步骤：  
1. 计算对齐地址后的页目录起始地址。  
2. 在页目录的页表项中填充二级页表的地址。二级页表一般为相邻的连续多个4KB的内存空间。低12位由于地址对齐的原因在寻址中没有用处。作为页表的标记位，建立页表时需要做好相应的标记。多余的页表项填充无效的地址信息。  
3. 填充二级页表的页表项。可以简单的填充位连续的4KB物理地址，填充对应的页表项标记位。  
4. 调用PDIR指令设置页目录起始地址。  
5. 调用SPAG指令打开页表使能。  
6. 修改内核栈的位置。  

然后对页表进行了读写测试，错误和正确的读写都做了测试。

## 问题  
对编译器代码c.c中有一处疑问。
函数emi中应该是对指令的非指令编码部分进行检查。  
```c
if (c<<8>>8 != c)
```  
这里判断c的高8位是不是都为0。但是`c`使用了`int`类型，若`c`的第23位为1，则因为时有符号整数，右移时使用了1进行补位，就会出现不相等的情况。
所以此处`c`应该使用无符号整数类型。
